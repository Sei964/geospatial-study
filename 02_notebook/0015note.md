---
title: 京都市における環境公平性インデックス（EI）の算出
description: LST・NO₂・交通リスクを統合した環境リスクスコアと人口密度を重ね合わせ、環境公平性インデックス（EI）を計算するGEEワークフロー
authors: [Seiichi]
tags: [GEE, 環境公平性, LST, NO2, WorldPop, 公共政策, 都市環境, リスク評価]
date: 2025-12-13
language: ja
---
# **概要**

このワークフローでは、以下の3つの環境リスク要因を統合し、京都市における高リスクエリアを抽出します：

1. **LST（地表面温度）**：Landsat 8の熱赤外バンドから算出

2. **NO₂濃度**：Sentinel-5Pの対流圏NO₂カラム密度

3. **交通リスク**：主要道路からの50mバッファ

これらをZスコアで標準化し、合算して**総合リスクスコア**を作成。 その上位10%（P90以上）を「高リスクエリア」と定義し、WorldPopの人口密度データと重ね合わせて、 **環境公平性インデックス（EI)を算出***します。

---
## ステップごとの解説

1. 人口密度データの取得とマスク

```python
population_collection = ee.ImageCollection('WorldPop/GP/100m/pop')\
    .filter(ee.Filter.eq('country', 'JPN'))\
    .filterDate('2020-01-01', '2020-12-31')

pop_image = population_collection.first().rename('population')
pop_mask = pop_image.gt(0)
kyoto_population = pop_image.updateMask(pop_mask).clip(kyoto_aoi)
```
>- WorldPopの2020年日本データを取得
>- 人口が0のピクセルをマスクし、京都市AOIにクリップ

2. 環境リスク要因の取得と標準化
   
**LST（地表面温度）**
```python
LST = image.select('ST_B10').multiply(0.00341802).add(149.0).subtract(273.15)
```
>- Landsat 8の ST_B10 バンドを摂氏に変換
>- 京都市全体の平均・標準偏差を使ってZスコア化

**NO₂（大気汚染）**
```python
no2_image = s5p_collection.median().select('tropospheric_NO2_column_number_density')
```
>- Sentinel-5PのNO₂濃度を中央値合成
>- 同様にZスコア化

**交通リスク**
```python
risk_zones = roads.map(lambda feature: feature.buffer(50))
traffic_risk_image = risk_zones.reduceToImage(...).unmask(0)
```
>- 道路に50mバッファをかけてリスクゾーンを作成
>- バイナリ画像（1:リスクあり, 0:なし）に変換

3. 総合リスクスコアの作成とP90抽出

```python
combined_risk = LST_z_score.add(NO2_z_score).add(traffic_risk_image)
p90_threshold = combined_risk.reduceRegion(...).get('Total_Risk_Score')
high_risk_mask_unpopulated = combined_risk.gt(p90_threshold)
```
>- 各要因を加算して総合リスクスコアを作成
>- 上位10%（P90）を抽出してバイナリマスク化

4. 高リスクかつ人口が存在するエリアの抽出

```python
high_risk_area = high_risk_mask_unpopulated.updateMask(pop_mask)
population_in_high_risk = kyoto_population.updateMask(high_risk_area)
```
>- 高リスクマスクと人口マスクを掛け合わせて交差領域を抽出
>- その領域における人口密度画像を作成

5. 平均人口密度とEIの計算

```python
kyoto_population_mean = kyoto_population.reduceRegion(...).get('population')
pop_in_high_risk_mean = population_in_high_risk.reduceRegion(...).get('population')
EI = ee.Number(pop_in_high_risk_mean).divide(ee.Number(kyoto_population_mean))
```
>- 京都市全体と高リスクエリアの平均人口密度を計算
>- EI = μ_risk / μ_all を算出

6. 結果の表示

```python
result_info = ee.Dictionary({...})
print('環境公平性インデックス:', ee.Number(result_info.get('Equity_Index_EI')).format('%.3f').getInfo())
```
>- 結果を辞書にまとめて表示
>- `.getInfo() `は最後に使うのがポイント！

---
**解釈のヒント**
- EI > 1：高リスクエリアに人口が集中（不公平）
- EI ≈ 1：リスクと人口が均等に分布
- EI < 1：高リスクエリアに人が少ない（比較的公平）

---
**注意点と改善アイデア**

- WorldPopの年次データは国ごとに分かれているため、country='JPN' のフィルタが必須
- `.clip() `はマスク処理の後に行うと安全
- `reduceRegion() `のスケールは各データの解像度に合わせる
- EIの空間的分布を可視化するには、ピクセル単位のEIマップを作るのも面白い！